<section class="courses container my-3 text-center">
 
  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-primary fw-semibold px-3 py-1 m-2" *ngIf="Admin" (click)="openCourseModal()">Add Course</button>
    <button class="btn btn-primary fw-semibold px-3 py-1 m-2" *ngIf="Admin" (click)="openDeleteModal()">Delete</button>
  </div>
 
  <div class="modal fade show d-block" *ngIf="showDeleteModal" tabindex="-1" style="background-color: rgba(0,0,0,0.5); backdrop-filter: blur(6px);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg p-4">
        <span class="position-absolute top-0 end-0 fs-2 fw-bold text-secondary me-3 mt-2" role="button" (click)="closeDeleteModal()">&times;</span>
        <h2 class="modal-title fw-bold fs-3 text-center mb-4">Delete Course</h2>

        <div class="mb-3">
          <label class="form-label fw-semibold">Select Course to Delete</label>
          <select class="form-select" [(ngModel)]="selectedCourse" name="deleteCourse">
            <option *ngFor="let course of courses" [value]="course.title">{{ course.title }}</option>
          </select>
        </div>

        <div class="d-flex justify-content-center mt-3">
          <button class="btn btn-danger px-4" (click)="onDeleteCourseSubmit()">Delete</button>
        </div>
      </div>
    </div>
  </div>

  
  <div class="modal fade show d-block mt-5" *ngIf="showCourseModal" tabindex="-1" style="background-color: rgba(0,0,0,0.5); backdrop-filter: blur(6px);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg p-4">
        <span class="position-absolute top-0 end-0 fs-2 fw-bold text-secondary me-3 mt-2" role="button" (click)="closeCourseModal()">&times;</span>

        <h2 class="modal-title fw-bold fs-3 text-center mb-4" style="background: linear-gradient(90deg, #4B4FFF, #FF4DB7); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
          Add New Course
        </h2>

        <form [formGroup]="courseForm" (ngSubmit)="onAddCourseSubmit()" class="text-start">
          <div class="mb-3">
            <label class="form-label fw-semibold">Title</label>
            <input type="text" class="form-control rounded-3" formControlName="title" placeholder="Enter course title" />
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Image</label>
            <input type="file" accept="image/*" class="form-control rounded-3" (change)="onFileSelected($event)" />
            <div *ngIf="imagePreview" class="mt-3 text-center">
              <img [src]="imagePreview" alt="Preview" class="img-fluid rounded-3" style="max-height: 200px; object-fit: cover;" />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Rating</label>
            <input type="number" class="form-control rounded-3" formControlName="rating" placeholder="e.g. 4.5" />
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Rating Count</label>
            <input type="text" class="form-control rounded-3" formControlName="ratingsCount" placeholder="e.g. 500k ratings" />
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Total Hours</label>
            <input type="text" class="form-control rounded-3" formControlName="totalHours" placeholder="e.g. 12h 30min" />
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Price</label>
            <input type="number" class="form-control rounded-3" formControlName="price" placeholder="Enter price in USD" />
          </div>

          
          <div formArrayName="chapters" class="mb-3">
            <div *ngFor="let chapter of chapters.controls; let i = index" [formGroupName]="i" class="border p-2 mb-2 rounded-3">
              <label>Chapter {{ i + 1 }} Title</label>
              <input type="text" class="form-control mb-1" formControlName="title" placeholder="Chapter Title" />

              <label>Video URL</label>
              <input type="text" class="form-control mb-1" formControlName="videoUrl" placeholder="Video URL" />

              <label>Video Duration</label>
              <input type="text" class="form-control mb-1" formControlName="videoDuration" placeholder="Video Duration" />

              <button type="button" class="btn btn-danger btn-sm mt-1" (click)="removeChapter(i)">Remove Chapter</button>
            </div>

            <button type="button" class="btn btn-secondary mt-2" (click)="addChapter()">Add Chapter</button>
          </div>

          <div class="d-flex justify-content-center">
            <button type="submit" [disabled]="courseForm.invalid" class="btn btn-primary fw-semibold px-4">Save Course</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  
  <h2 class="fw-bold fs-1 mb-4" style="background: linear-gradient(90deg, #4B4FFF, #FF4DB7); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
    {{ title }}
  </h2>

  
  <div class="d-flex justify-content-center flex-wrap gap-4">
    <div class="card shadow-sm border-0 rounded-4" style="width: 340px;" *ngFor="let course of courses">
      <img [src]="course.image" [alt]="course.title" class="card-img-top rounded-top-4" style="height:200px; object-fit:cover;" />

      <div class="card-body text-center">
        <h3 class="fw-bold text-primary fs-6">{{ course.title | uppercase }}</h3>

        <div class="d-flex justify-content-center flex-wrap gap-2 my-2">
          <span class="badge rounded-pill border px-3 py-1 text-secondary">
            <i class="bi bi-star-fill" style="color: rgb(121, 120, 120);"></i> {{ course.rating }}
          </span>
          <span class="badge rounded-pill border px-3 py-1 text-secondary">{{ course.ratingsCount }}</span>
          <span class="badge rounded-pill border px-3 py-1 text-secondary">{{ course.totalHours }}</span>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-3 px-3">
          <p class="fw-bold fs-5 text-primary mb-0">{{ course.price | currency:'USD':'symbol':'1.0-2' }}</p>
          <button class="btn btn-primary rounded-3 shadow-sm" 
                  (click)="handleEnrollment((user?.enrolledCourses ?? []).includes(course.title), course)">
            <b>{{ (user?.enrolledCourses ?? []).includes(course.title) ? "Enrolled" : "Enroll now" }}</b>
          </button>
        </div>
      </div>
    </div>
  </div>

  <router-outlet></router-outlet>
</section>
